<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Game Player</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="png" href="Images/Game Player Favicon.png">
  <style>
    html,body{height:100%;margin:0;background:#000;color:#fff;font-family:'Fedora One',cursive}
    .toolbar{padding:8px;background:rgba(0,0,0,.6);display:flex;align-items:center;gap:12px}
    #gameFrame{width:100%;height:calc(100% - 48px);border:0;display:block;background:#000}
    .msg{padding:18px}
  </style>
</head>
<body>
  <div class="toolbar">
    <a href="index.html">← Back</a>
    <span id="title">Loading…</span>
    <p>Please play these games on fullscreen</p>
  </div>

  <iframe id="gameFrame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms" 
          allow="fullscreen" allowfullscreen></iframe>

  <div id="fallback" class="msg" style="display:none"></div>

<script>
    const params = new URLSearchParams(location.search);
    const key = params.get('game');

    // map known game keys to a preferred path (adjust key/folder names to match your repo)
    const games = {
      "game1": "games/game1/HTML/HTML/index.html",
      "game2": "Games/game2/index.html"
    };

    const titleEl = document.getElementById('title');
    const frame = document.getElementById('gameFrame');
    const fallback = document.getElementById('fallback');

    // try common export locations and load the first that exists
    async function findAndLoadGame(name) {
      const candidates = [
        games[name],                         // explicit map (may be undefined)
        `games/${name}/index.html`,
        `games/${name}/HTML/index.html`,
        `games/${name}/HTML/HTML/index.html`,
        `games/${name}.html`
      ].filter(Boolean);

      for (const url of candidates) {
        try {
          const res = await fetch(url, { method: "HEAD" });
          if (res.ok) {
            titleEl.textContent = "Playing: " + name;
            frame.src = url;
            frame.onload = () => titleEl.textContent = "Playing: " + name;
            return;
          }
        } catch (e) {
          // network/error — continue to next candidate
        }
      }

      // none found
      titleEl.textContent = "Game not found";
      frame.style.display = "none";
      fallback.style.display = "block";
      fallback.innerHTML = `<strong>Game "${name}" not found.</strong><br>Paths tried:<br><code>${candidates.join("<br>")}</code>`;
    }

    if (key) {
      findAndLoadGame(key);
    } else {
      titleEl.textContent = 'No game selected';
      fallback.style.display = 'block';
      fallback.innerHTML = '<strong>Game not found.</strong><br>' +
        'Available: ' + Object.keys(games).map(k=>`<a href="player.html?game=${k}">${k}</a>`).join(' • ');
      frame.style.display = 'none';
    }
  </script>
</body>
</html>